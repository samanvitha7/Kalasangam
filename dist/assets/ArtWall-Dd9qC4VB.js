import{l as J,r as c,i as f,j as s,F as X,m as n,$ as G,L as V,v as q,b as Q,c as Z,a0 as ee,a3 as te,s as se,t as oe}from"./index-D3qpkmvJ.js";import{a as ae,C as re,s as l,g as u,A as g}from"./ArtCard-NlE2Qt8X.js";import{A as F}from"./index-5xPmm2RN.js";import"./LazyImage-C3F1wNKI.js";const ue=()=>{const{user:a,isAuthenticated:h,updateUser:j}=J(),[v,x]=c.useState([]),[U,b]=c.useState(!1),[C,A]=c.useState(!0),[k,D]=c.useState(""),[w,B]=c.useState("all"),[S,P]=c.useState("newest"),[T,N]=c.useState(new Set),[ie,ne]=c.useState(new Set),[d,E]=c.useState(null),[p,I]=c.useState(!1),O=async()=>{try{A(!0);const e=await f.getArtworks({limit:50,sortBy:"createdAt",sortOrder:"desc"});if(e.success){const o=e.data.map(t=>{var i;console.log("ArtWall - Original artwork.userId:",t.userId,"type:",typeof t.userId);const r=t.userId?typeof t.userId=="object"?t.userId._id:t.userId.toString():(i=t.artistId)==null?void 0:i.toString();return console.log("ArtWall - Transformed userId:",r,"type:",typeof r),{id:t._id||t.id,title:t.title||t.name,description:t.description,artist:t.artist||"Cultural Heritage",imageUrl:t.imageUrl||t.image,category:t.category||"Traditional Art",likes:t.likes||[],bookmarks:t.bookmarks||[],likeCount:t.likeCount||(t.likes?t.likes.length:0),bookmarkCount:t.bookmarkCount||(t.bookmarks?t.bookmarks.length:0),createdAt:t.createdAt||new Date().toISOString(),userId:r,origin:t.origin}});x(o)}else console.error("Failed to fetch artworks:",e.message),x([])}catch(e){console.error("Error fetching artworks:",e),l.error("Failed to load artworks. Please try again later."),x([])}finally{A(!1)}};c.useEffect(()=>{O(),h&&a&&(console.log("ArtWall useEffect - user authenticated:",{user:a,userLikes:a.likes}),M())},[h,a]);const M=async()=>{try{const e=await f.getCurrentUser();if(console.log("ArtWall fetchUserBookmarks response:",e),e&&e.user){const o=new Set((e.user.bookmarks||[]).map(t=>t.toString()));N(o),e.user.likes&&JSON.stringify(e.user.likes)!==JSON.stringify(a==null?void 0:a.likes)&&(console.log("Updating user likes from fetchUserBookmarks:",e.user.likes),j({likes:e.user.likes,bookmarks:e.user.bookmarks}))}}catch(e){console.error("Error fetching user bookmarks:",e)}},L=v.filter(e=>{const o=w==="all"||e.category.toLowerCase()===w,t=e.title.toLowerCase().includes(k.toLowerCase())||e.artist.toLowerCase().includes(k.toLowerCase())||e.description.toLowerCase().includes(k.toLowerCase());return o&&t}).sort((e,o)=>{switch(S){case"newest":return new Date(o.createdAt)-new Date(e.createdAt);case"oldest":return new Date(e.createdAt)-new Date(o.createdAt);case"likes":return(o.likeCount||0)-(e.likeCount||0);case"artist":return e.artist.localeCompare(o.artist);default:return 0}}),R=()=>{if(!h){l.error("Please login or create an account to contribute your artwork");return}b(!0)},W=async e=>{try{console.log("Submitting artwork:",e);const o=await f.createArtwork(e);console.log("Artwork created:",o);const t=o.data||o,r={id:t._id||t.id,title:t.title,description:t.description,artist:t.artist||(a==null?void 0:a.name)||"Anonymous",imageUrl:t.imageUrl,category:t.category,likes:t.likes||0,bookmarks:t.bookmarks||0,createdAt:t.createdAt||new Date().toISOString(),userId:t.userId||(a==null?void 0:a.id)};x([r,...v]),b(!1),l.success("Your artwork has been added to the Art Wall!"),u.emit(g.CREATED,{artwork:r,userId:a==null?void 0:a.id}),localStorage.setItem("artworkCreated",Date.now().toString()),window.dispatchEvent(new CustomEvent("artworkCreated",{detail:r}))}catch(o){console.error("Failed to create artwork:",o),l.error("Failed to create artwork. Please try again.")}},_=async e=>{if(!h){l.error("Please login to like artworks");return}try{console.log("ArtWall handleLike starting:",{artworkId:e,currentUser:a,userLikes:a==null?void 0:a.likes});const o=await f.toggleLike(e);if(console.log("ArtWall handleLike API response:",o),o.success){if(console.log("ArtWall handleLike response:",{artworkId:e,response:o}),x(t=>t.map(i=>{if(i.id===e){const m={...i,likeCount:o.likeCount,likes:o.likes,isLiking:!1};return console.log("ArtWall updating artwork:",{original:i,updated:m,responseLikes:o.likes,responseLikeCount:o.likeCount}),m}return i})),a){const t=[...a.likes||[]],r=e.toString();if(console.log("Before user likes update:",{currentLikes:t,artworkIdStr:r,liked:o.liked}),o.liked)t.find(i=>i.toString()===r)||(t.push(r),console.log("Added to likes:",t));else{const i=t.findIndex(m=>m.toString()===r);i>-1&&(t.splice(i,1),console.log("Removed from likes:",t))}console.log("Updating user with new likes:",t),j({likes:t})}o.liked?(l.success("Artwork liked!",{autoClose:2e3}),u.emit(g.LIKED,{artworkId:e.toString(),userId:a==null?void 0:a.id})):(l.success("Like removed!",{autoClose:2e3}),u.emit(g.UNLIKED,{artworkId:e.toString(),userId:a==null?void 0:a.id})),u.emit(g.USER_STATS_UPDATED,{userId:a==null?void 0:a.id,likeChange:o.liked?1:-1})}}catch(o){console.error("Error toggling like:",o),l.error("Failed to toggle like. Please try again.")}},z=async e=>{if(!h){l.error("Please login to bookmark artworks");return}try{const o=await f.toggleBookmark(e);o.success&&(N(t=>{const r=new Set(t),i=e.toString();return o.bookmarked?(r.add(i),l.success("Artwork bookmarked!",{autoClose:2e3}),u.emit(g.BOOKMARKED,{artworkId:i,userId:a==null?void 0:a.id})):(r.delete(i),l.success("Bookmark removed!",{autoClose:2e3}),u.emit(g.UNBOOKMARKED,{artworkId:i,userId:a==null?void 0:a.id})),r}),x(t=>t.map(r=>r.id===e?{...r,bookmarkCount:o.bookmarkCount,bookmarks:o.bookmarks}:r)),u.emit(g.USER_STATS_UPDATED,{userId:a==null?void 0:a.id,bookmarkChange:o.bookmarked?1:-1}))}catch(o){console.error("Error toggling bookmark:",o),l.error("Failed to toggle bookmark. Please try again.")}},K=e=>{E(e),I(!0),document.body.style.overflow="hidden"},y=()=>{I(!1),E(null),document.body.style.overflow="unset"},$=async(e,o)=>{try{const r=await(await fetch(e)).blob(),i=window.URL.createObjectURL(r),m=document.createElement("a");m.href=i,m.download=`${o.replace(/\s+/g,"_")}.jpg`,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(i),l.success("Image downloaded successfully!")}catch(t){console.error("Error downloading image:",t),l.error("Failed to download image. Please try again.")}};c.useEffect(()=>{const e=t=>{t.key==="Escape"&&p&&y()},o=()=>{p&&y()};return p&&(document.addEventListener("keydown",e),window.addEventListener("popstate",o),window.history.pushState({fullscreen:!0},"")),()=>{document.removeEventListener("keydown",e),window.removeEventListener("popstate",o)}},[p]);const H=["all","traditional","contemporary","abstract","landscape","digital"],Y=()=>{const e=Array.from({length:15},(o,t)=>({id:t,size:Math.random()*4+2,color:["rgba(19, 72, 86, 0.6)","rgba(224, 82, 100, 0.6)","rgba(244, 140, 140, 0.6)","rgba(29, 124, 111, 0.6)","rgba(255, 215, 0, 0.6)"][Math.floor(Math.random()*5)],initialX:Math.random()*100,initialY:Math.random()*100,animationDelay:Math.random()*5,animationDuration:8+Math.random()*6}));return s.jsx("div",{className:"fixed inset-0 pointer-events-none z-0",children:e.map(o=>s.jsx(n.div,{className:"absolute rounded-full opacity-40",style:{width:`${o.size}px`,height:`${o.size}px`,backgroundColor:o.color,left:`${o.initialX}%`,top:`${o.initialY}%`,filter:"blur(0.5px)",boxShadow:`0 0 ${o.size*2}px ${o.color}`},animate:{y:[0,-80,0],x:[0,25,-25,0],opacity:[.4,.7,.4],scale:[1,1.3,1]},transition:{duration:o.animationDuration,repeat:1/0,delay:o.animationDelay,ease:"easeInOut"}},o.id))})};return s.jsxs("div",{className:"min-h-screen bg-[#F8E6DA] pb-8 overflow-hidden",children:[s.jsx(X,{}),s.jsx(Y,{}),s.jsxs("div",{className:"container mx-auto px-4 pt-10 relative z-10",children:[s.jsxs(n.section,{className:"text-center mb-12",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8},children:[s.jsx(n.div,{className:"absolute w-96 h-96 bg-gradient-to-r from-[#E05264]/20 to-[#F48C8C]/20 rounded-full blur-3xl opacity-30 top-0 left-0",animate:{scale:[1,1.2,1],rotate:[0,90,0],opacity:[.3,.5,.3]},transition:{duration:10,repeat:1/0,ease:"easeInOut"}}),s.jsx("h1",{className:"inline-block text-6xl font-dm-serif mb-6 drop-shadow-lg bg-gradient-to-r from-[#134856] to-[#e05264] bg-clip-text text-transparent",children:"Art Wall"}),s.jsx("p",{className:"text-lg font-lora font-semibold text-xl text-[#E05264] max-w-3xl mx-auto leading-relaxed mb-10",children:"A collaborative space where artists share their creativity and passion. Discover, appreciate, and contribute to our growing collection of artistic expressions."}),s.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row gap-4 justify-center items-center",children:[s.jsxs(n.button,{onClick:R,className:"bg-gradient-to-r from-[#1d7c6f] to-[#f58c8c] text-white px-8 py-4 rounded-full font-semibold text-lg shadow-lg hover:shadow-xl transition-all duration-300 flex items-center gap-2 font-dm-serif",whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},children:[s.jsx(G,{className:"text-white"}),"Contribute Your Art"]}),s.jsx(n.div,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.95},children:s.jsxs(V,{to:"/community-guidelines",className:"bg-gradient-to-r from-[#1d7c6f] to-[#f58c8c] text-white px-8 py-4 rounded-full font-semibold text-lg shadow-lg hover:shadow-xl transition-all duration-300 flex items-center gap-2 font-dm-serif",children:[s.jsx(q,{className:"text-white"}),"Community Guidelines"]})})]})]}),s.jsx(n.div,{className:"bg-gradient-to-br from-[#1d7c6f] to-[#f58c8c] rounded-3xl shadow-2xl p-2 mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.2},children:s.jsx("div",{className:"bg-[#F8E6DA] rounded-2xl p-6",children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[s.jsxs("div",{className:"relative flex-1 max-w-md",children:[s.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search artworks, artists...",value:k,onChange:e=>D(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),s.jsxs("div",{className:"flex gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Z,{className:"text-gray-600"}),s.jsx("select",{value:w,onChange:e=>B(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:H.map(e=>s.jsx("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),s.jsxs("select",{value:S,onChange:e=>P(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:[s.jsx("option",{value:"newest",children:"Newest First"}),s.jsx("option",{value:"oldest",children:"Oldest First"}),s.jsx("option",{value:"likes",children:"Most Liked"}),s.jsx("option",{value:"artist",children:"By Artist"})]})]})]})})}),C&&s.jsx("div",{className:"flex justify-center items-center py-16",children:s.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-amber-600"})}),s.jsx(F,{children:s.jsx(n.div,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",initial:{opacity:0},animate:{opacity:1},transition:{duration:.8,delay:.4},children:L.map((e,o)=>{var t;return s.jsx(ae,{artwork:e,index:o,currentUser:a,isBookmarked:T.has(e.id?e.id.toString():(t=e._id)==null?void 0:t.toString()),onLike:_,onBookmark:z,onImageClick:K},e.id)})})}),!C&&L.length===0&&s.jsxs(n.div,{className:"text-center py-16",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},children:[s.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ¨"}),s.jsx("h3",{className:"text-2xl font-semibold text-gray-700 mb-2",children:"No artworks found"}),s.jsx("p",{className:"text-gray-500",children:"Try adjusting your search or filter criteria"})]}),s.jsx(F,{children:p&&d&&s.jsxs(n.div,{className:"fixed inset-0 bg-black bg-opacity-95 z-50 flex items-center justify-center p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},onClick:y,children:[s.jsx(n.button,{className:"absolute top-4 right-4 text-white text-2xl hover:text-gray-300 transition-colors z-60",onClick:y,initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.2},children:s.jsx(ee,{})}),s.jsx(n.button,{className:"absolute top-4 right-16 text-white text-xl hover:text-gray-300 transition-colors z-60",onClick:e=>{e.stopPropagation(),$(d.imageUrl,d.title)},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.3},children:s.jsx(te,{})}),s.jsxs(n.div,{className:"relative max-w-screen-lg max-h-screen-80 w-full h-full flex items-center justify-center",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{duration:.4},onClick:e=>e.stopPropagation(),children:[s.jsx("img",{src:d.imageUrl,alt:d.title,className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl",style:{maxHeight:"85vh"}}),s.jsxs(n.div,{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black/70 to-transparent p-6 rounded-b-lg",initial:{y:50,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.3},children:[s.jsx("h3",{className:"text-white text-2xl font-bold mb-2",children:d.title}),s.jsxs("p",{className:"text-gray-300 text-lg mb-3",children:["by ",d.artist]}),s.jsx("p",{className:"text-gray-400 text-sm mb-4",children:d.description}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-white",children:[s.jsx(se,{className:"text-red-500"}),s.jsx("span",{children:d.likeCount})]}),s.jsxs("div",{className:"flex items-center gap-2 text-white",children:[s.jsx(oe,{className:"text-blue-500"}),s.jsx("span",{children:d.bookmarkCount})]}),s.jsx("span",{className:"text-gray-400 text-sm",children:d.category})]})]})]}),s.jsx(n.div,{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-gray-400 text-sm text-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:s.jsx("p",{children:"Press ESC or click outside to close"})})]})}),s.jsx(re,{isOpen:U,onClose:()=>b(!1),onSubmit:W})]})]})};export{ue as default};
